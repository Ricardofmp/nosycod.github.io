---
title: Vinethorn - Spyware 
classes: wide
header:
  teaser: /assets/images/MA/VinethornV1/thorn-upscaled.jpg
ribbon: MidnightBlue
categories:
  - Malware-analysis
toc: true
---

This is a sample gathered from [Not So Boring Android Malware](https://maldroid.github.io/android-malware-samples/).

# APT42


Vinethorn is an Android Spyware attributed to APT42, a state-sponsored group that is believed to operate as the intelligence gathering arm of Iran’s Islamic Revolutionary Guard Corps, IRGC-IO.

It differs from APT35, another Advanted Persistent Threat group associated with the IRGC, as the latter is more oriented towards long-term operations targeting different industries in the US and the Middle East, while APT42’s activities focus on individuals and entities for “domestic politics, foreign policy and regime stability purposes”

The group “uses highly targeted spear-phishing and social engineering techniques designed to build trust and rapport with their victims in order to access their personal or corporate email accounts or to install Android malware on their mobile devices,” according to [Mandiant](https://www.mandiant.com/resources/blog/apt42-charms-cons-compromises). 

It is known for using hacked email accounts and associated with think tanks to target researchers and other academic organizations, ofter impersonating journalists and other professionals to engage with the victims for several days or even weeks before sending a malicious link. Another campaign was also found targeting members of an Iranian opposition group.

## Vinethorn

We’ll be analysing a sample of Vinethorn posted on [MalwareBazaar](https://bazaar.abuse.ch/sample/5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5/) on February 2023

<p align="center">
  <img src="\assets\images\MA\VinethornV1\1.png" />
</p>
<center><font size="3"> <u>Figure</u>(1) App's icon<u></u> </font></center>
<br>


The app is trying to impersonate a VPN application called SaferVPN. This same name is reported by [HackerNews](https://thehackernews.com/2022/09/iranian-apt42-launched-over-30.html) as an active campaign from April to October 2021.



# Spyware Capabilities

<p align="center">
  <img src="/assets/images/MA/VinethornV1/2.png" />
</p>
<center><font size="3"> <u>Figure</u>(2) App's permissions<u></u> </font></center>
<br>
While analyzing the permissions used by the app, we can see that it requests a lot of dangerous permissions such as ….

<p align="center">
  <img src="/assets/images/MA/VinethornV1/3.png" />
</p>
<center><font size="3"> <u>Figure</u>(3) Constants class<u></u> </font></center>
<br>

On this `Constants` class, we can find what seems to be the C&C, along with some endpoints to the web api. It becomes quite clear that the malware has modules to steal the following data from the device:
<br>public IP, retrieve logs, session?, downloads (and another module for “big downloads”), audio, clipboard data and gps data on the victim .


By checking the references, we discover a giant class called `Functions`. This has pretty much all the logic for the malware part of the application. We’ll go through some examples later on the analysis.

When the user launches the application, it sends some data to the cdsa.xyz/API/Session endpoint:
<p align="center">
  <img src="/assets/images/MA/VinethornV1/4.png" />
</p>
<center><font size="3"> <u>Figure</u>(4) Post request<u></u> </font></center>
<br>

In our case, the decoded session values:

`Android___RSR1.210210.001.A1;;Android SDK: 30 (11);;-;;RSR1.210210.001.A1;;0.0;;0.0;;;;SaferVPN`

It sends it every 10 or 15??? seconds.

<p align="center">
  <img src="/assets/images/MA/VinethornV1/5.png" />
</p>
<center><font size="3"> <u>Figure</u>(5) Function sending data to the C&C<u></u> </font></center>
<br>

Then, it acts based on the response from the C2C. On the `main_func()`, inside the Functions class, we have an infinite loop defining the next step.  

For example, DownloadModule has 2 modes, based on a boolean value:

- Run
- Stop

We don’t have the response from the C&C, as the server was taken down, but we can assume that the malware operator can send this command to initiate or stop this module (and the others).

<p align="center">
  <img src="/assets/images/MA/VinethornV1/6.png" />
</p>
<center><font size="3"> <u>Figure</u>(6) Partial main_func() code<u></u> </font></center>
<br>

## Download Module
This module will send the files on the external storage of the device, as long as they are not over 20mb, to the right endpoint (Api/AndroidBigDownload), with that Send_BigData_By_Http function, specifically crafted for bigger files.

<p align="center">
  <img src="/assets/images/MA/VinethornV1/7.png" />
</p>
<center><font size="3"> <u>Figure</u>(7) Download Module Code<u></u> </font></center>
<br>

## Audio Module
The audio module creates a new file,audio.mp3, sets the audio source to the microphone of the device and start recording for 30 seconds. Then it stops recording and sends the file to C&C.
<p align="center">
  <img src="/assets/images/MA/VinethornV1/8.png" />
</p>
<center><font size="3"> <u>Figure</u>(8) Audio Module Code<u></u> </font></center>
<br>

## Camera Module
The camera module allows the atackers to take pictures both with the front and the back camera, depending on C&C command. 

<p align="center">
  <img src="/assets/images/MA/VinethornV1/9.png" />
</p>
<center><font size="3"> <u>Figure</u>(9) Camera Module Code<u></u> </font></center>
<br>

It is definitely trying to stay hidden, as it turns down the volume of the device plus the shutter sound.

`((AudioManager) _context.getSystemService("audio")).setStreamMute(1, **true**);`
<p align="center">
  <img src="/assets/images/MA/VinethornV1/10.png" />
</p>
<center><font size="3"> <u>Figure</u>(10) Shutter sound turned off<u></u> </font></center>
<br>

After the picture is taken, it sends it to the C&C, as expected.

<p align="center">
  <img src="/assets/images/MA/VinethornV1/9.png" />
</p>
<center><font size="3"> <u>Figure</u>(11) Send picture to C&C<u></u> </font></center>
<br>


## Send SMS Module

This is a very interesting functionality. It probably serves the purpose of impersonating the owner of the device and leverage on that trust to apply phishing techniques.

<p align="center">
  <img src="/assets/images/MA/VinethornV1/9.png" />
</p>
<center><font size="3"> <u>Figure</u>(11) Send picutre to C&C<u></u> </font></center>
<br>

# Conclusion

It is the fifth sample on the [Not So Boring Android Malware](https://maldroid.github.io/android-malware-samples/) `Easy Samples`' section, with almost no obfuscation, so it was not the most complex. 
<br>However, this was still a very interesting sample to analyze. 

Due to time constraints, it was not possible to analyze all functionalities and modules, such as read received sms, access GPS location, clipboard access (keylogging capabilities), contacts, etc. We will definitely analyze and dissect a more recent version of Vinethorn in the future.


# IoCs

APK SHA256: `5d3ff202f20af915863eee45916412a271bae1ea3a0e20988309c16723ce4da5`

Package name: `com.example.vpnner`

